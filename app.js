const I18N={en:{alert:"SNAP changes — find free food today. This site is community-run; call ahead when possible.",searchPH:"Search by name or city",route:"Route via bus",call:"Call",callFirst:"Call first",badges:{fridge:"24/7 fridge", noid:"No ID required", kids:"Kid friendly", freeride:"Free ride?"},footer:"Community-run. Data may change — verify hours. Install this app from your browser menu to use offline."},es:{alert:"Cambios en SNAP — encuentra comida gratis hoy. Este sitio es comunitario; si puedes, llama antes.",searchPH:"Buscar por nombre o ciudad",route:"Ruta en autobús",call:"Llamar",callFirst:"Llamar antes",badges:{fridge:"Refrigerador 24/7", noid:"Sin identificación", kids:"Apto para niños", freeride:"¿Viaje gratis?"},footer:"Comunitario. Los datos pueden cambiar — verifica horarios. Instala la app desde tu navegador para usarla sin conexión."}};let lang='en';const $=sel=>document.querySelector(sel);const listEl=$("#list"), qEl=$("#q"), typeEl=$("#type"), alertEl=$("#alert"), footerEl=$("#footer-copy");async function load(){const res=await fetch('data/locations.json');const data=await res.json();window._DATA=data;render();}function setLang(l){lang=l;alertEl.textContent=I18N[lang].alert;qEl.placeholder=I18N[lang].searchPH+" / "+I18N[lang=='en'?'es':'en'].searchPH;footerEl.textContent=I18N[lang].footer;render();}function render(){const q=(qEl.value||'').toLowerCase();const type=typeEl.value;const items=(window._DATA||[]).filter(it=>{const hay=[it.name,it.city,it.address].join(' ').toLowerCase();const okQ=!q || hay.includes(q);const okT=!type || (it.type===type);return okQ && okT;});listEl.innerHTML=items.map(toCard).join('') || `<div class="card">No results.</div>`;}function toCard(it){const routeUrl=`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(it.address+', '+(it.city||'')+', Iowa')}&travelmode=transit`;const callBtn = it.phone?`<a class="btn" href="tel:${it.phone.replace(/[^+\d]/g,'')}">${I18N[lang].call}</a>`:'';const badges=[it.isFridge?I18N[lang].badges.fridge:null,it.noId?I18N[lang].badges.noid:null,it.kids?I18N[lang].badges.kids:null,it.freeRide?I18N[lang].badges.freeride:null].filter(Boolean).map(b=>`<span class="badge">${b}</span>`).join('');return `<div class="card"><h3>${it.name}</h3><div>${it.address}${it.city?', '+it.city:''}</div><div>${it.hours||''}</div><div>${it.notes||''}</div><div class="badges">${badges}</div><div class="row"><a class="btn primary" target="_blank" href="${routeUrl}">${I18N[lang].route}</a>${callBtn}</div></div>`;}$("#btn-en").onclick=()=>setLang('en');$("#btn-es").onclick=()=>setLang('es');["input","change"].forEach(ev=>qEl.addEventListener(ev,render));typeEl.addEventListener("change",render);$("#useLoc").onclick=()=>{if(!navigator.geolocation){alert("Location not available");return;}navigator.geolocation.getCurrentPosition(pos=>{alert("Location enabled. Choose a site and tap 'Route via bus'.");});};setLang('en');load();if('serviceWorker' in navigator){window.addEventListener('load',()=>{navigator.serviceWorker.register('sw.js');});}